# ============ init code for oscomp test ============
# setup the environment
alias busybox=/musl/busybox
busybox mkdir -p /bin
busybox ln -s /musl/busybox /bin/ls
busybox ls -la /bin
exit
/musl/busybox cp /musl/busybox /bin/busybox
# TODO: link busybox to /bin
busybox cp /musl/busybox /bin/ls
busybox mkdir -p /lib
#busybox mkdir -p /lib64
#busybox cp -v /glibc/lib/ld-linux-* /lib/
# basic testcase on riscv64 requires "ld-linux-riscv64-lp64.so.1",
# but we only have "ld-linux-riscv64-lp64d.so.1" in /glibc/lib
busybox cp -v /musl/lib/libc.so /lib/ld-musl-riscv64-sf.so.1

# ============ test cases compiled with musl ============
# setup musl libraries
# TODO: use symlink instead of cp
busybox cp -v /musl/lib/libc.so /lib/ld-musl-riscv64.so.1
# busybox cp /musl/lib/libc.so /lib/ld-musl-x86_64.so.1
# busybox cp /musl/lib/libc.so /lib/ld-musl-loongarch-lp64d.so.1
# busybox cp /musl/lib/libc.so /lib/ld-musl-aarch64.so.1
busybox cp -v /musl/lib/*.so /lib/
busybox cp /musl/lib/dlopen_dso.so /musl
# busybox cp -r /lib/. /lib64/
busybox ls -l /lib/
# begin test
/musl/entry-dynamic.exe argv
exit
/musl/libctest_testcode.sh
exit

# ============ init code for oscomp test ============
# setup the environment
/musl/busybox mkdir -p /bin
/musl/busybox cp /musl/busybox /bin/busybox
# TODO: link busybox to /bin
busybox cp /musl/busybox /bin/ls
busybox mkdir -p /lib
busybox mkdir -p /lib64
busybox cp -v /glibc/lib/ld-linux-* /lib/
# basic testcase on riscv64 requires "ld-linux-riscv64-lp64.so.1",
# but we only have "ld-linux-riscv64-lp64d.so.1" in /glibc/lib
busybox cp -v /musl/lib/libc.so /lib/ld-linux-riscv64-lp64.so.1

# ============ test cases compiled with musl ============
# setup musl libraries
# TODO: use symlink instead of cp
busybox cp -v /musl/lib/libc.so /lib/ld-musl-riscv64.so.1
/musl/busybox cp /musl/lib/libc.so /lib/ld-musl-riscv64-sf.so.1
# busybox cp /musl/lib/libc.so /lib/ld-musl-x86_64.so.1
# busybox cp /musl/lib/libc.so /lib/ld-musl-loongarch-lp64d.so.1
# busybox cp /musl/lib/libc.so /lib/ld-musl-aarch64.so.1
busybox cp -v /musl/lib/*.so /lib/
busybox cp /musl/lib/dlopen_dso.so /musl
# busybox cp -r /lib/. /lib64/
busybox ls -l /lib/
# begin test
#/musl/basic_testcode.sh
/musl/libctest_testcode.sh
/musl/runtest.exe -w entry-dynamic.exe argv
/musl/libc-bench
#busybox find /usr -name "libtcc.a"
exit

# ============ init code for oscomp test ============
# setup the environment
/musl/busybox mkdir -p /bin
/musl/busybox cp /musl/busybox /bin/busybox
# TODO: link busybox to /bin
busybox cp /musl/busybox /bin/ls
busybox mkdir -p /lib
busybox mkdir -p /lib64
busybox cp -v /glibc/lib/ld-linux-* /lib/
# basic testcase on riscv64 requires "ld-linux-riscv64-lp64.so.1",
# but we only have "ld-linux-riscv64-lp64d.so.1" in /glibc/lib
busybox cp /musl/lib/libc.so /lib/ld-linux-riscv64-lp64.so.1

# ============ test cases compiled with musl ============
# setup musl libraries
# TODO: use symlink instead of cp
busybox cp /musl/lib/libc.so /lib/ld-musl-riscv64-sf.so.1
#/musl/runtest.exe -w entry-dynamic.exe fscanf
#/musl/libc-bench
busybox find /usr -name "libtcc.a"
